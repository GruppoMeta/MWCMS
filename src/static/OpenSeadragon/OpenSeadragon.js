function Observer(){}if(!window.SeadragonConfig){window.SeadragonConfig={};SeadragonConfig.imgPath=""}Array.prototype.add=function(a,b){a[a.length]=b};Array.prototype.clear=function(a){a.length=0};Array.prototype.clone=function(a){return a.length===1?[a[0]]:Array.apply(null,a)};SArray=Array();if(!window.Function){window.Function={}}Function.prototype.createDelegate=function(a,b){return function(){if(arguments===undefined)arguments=[];return b.apply(a,arguments)}};String.format=function(a,b){return String._toFormattedString(false,arguments)};String._toFormattedString=function(a,b){var c="";var d=b[0];for(var e=0;;){var f=d.indexOf("{",e);var g=d.indexOf("}",e);if(f<0&&g<0){c+=d.slice(e);break}if(g>0&&(g<f||f<0)){if(d.charAt(g+1)!=="}"){throw Error.argument("format",Sys.Res.stringFormatBraceMismatch)}c+=d.slice(e,g+1);e=g+2;continue}c+=d.slice(e,f);e=f+1;if(d.charAt(e)==="{"){c+="{";e++;continue}if(g<0)throw Error.argument("format",Sys.Res.stringFormatBraceMismatch);var h=d.substring(e,g);var i=h.indexOf(":");var j=parseInt(i<0?h:h.substring(0,i),10)+1;if(isNaN(j))throw Error.argument("format",Sys.Res.stringFormatInvalid);var k=i<0?"":h.substring(i+1);var l=b[j];if(typeof l==="undefined"||l===null){l=""}if(l.toFormattedString){c+=l.toFormattedString(k)}else if(a&&l.localeFormat){c+=l.localeFormat(k)}else if(l.format){c+=l.format(k)}else c+=l.toString();e=g+1}return c};Observer.prototype={_getContext:function(a,b){var c=a._observerContext;if(c)return c();if(b){return(a._observerContext=this._createContext())()}return null},_createContext:function(){var a={events:new EventHandlerList};return function(){return a}}};var EventHandlerList=function a(){this._list={}};EventHandlerList.prototype={_addHandler:function(a,b){SArray.add(this._getEvent(a,true),b)},addHandler:function(a,b){this._addHandler(a,b)},_removeHandler:function(a,b){var c=this._getEvent(a);if(!c)return;SArray.remove(c,b)},_removeHandlers:function(a){if(!a){this._list={}}else{var b=this._getEvent(a);if(!b)return;b.length=0}},removeHandler:function(a,b){this._removeHandler(a,b)},getHandler:function(a){var b=this._getEvent(a);if(!b||!b.length)return null;b=SArray.clone(b);return function(a,c){for(var d=0,e=b.length;d<e;d++){b[d](a,c)}}},_getEvent:function(a,b){var c=this._list[a];if(!c){if(!b)return null;this._list[a]=c=[]}return c}};var Seadragon=new function(){};Seadragon.Utils=function(){function i(a,b){if(b&&a!=document.body){return document.body}else{return a.offsetParent}}var a={UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5};Seadragon.Browser=a;var b=this;var c=["Msxml2.XMLHTTP","Msxml3.XMLHTTP","Microsoft.XMLHTTP"];var d={bmp:false,jpeg:true,jpg:true,png:true,tif:false,wdp:false};var e=a.UNKNOWN;var f=0;var g=false;var h={};(function(){var b=navigator.appName;var c=navigator.appVersion;var d=navigator.userAgent;if(b=="Microsoft Internet Explorer"&&!!window.attachEvent&&!!window.ActiveXObject){var i=d.indexOf("MSIE");e=a.IE;f=parseFloat(d.substring(i+5,d.indexOf(";",i)))}else if(b=="Netscape"&&!!window.addEventListener){var j=d.indexOf("Firefox");var k=d.indexOf("Safari");var l=d.indexOf("Chrome");if(j>=0){e=a.FIREFOX;f=parseFloat(d.substring(j+8))}else if(k>=0){var m=d.substring(0,k).lastIndexOf("/");e=l>=0?a.CHROME:a.SAFARI;f=parseFloat(d.substring(m+1,k))}}else if(b=="Opera"&&!!window.opera&&!!window.attachEvent){e=a.OPERA;f=parseFloat(c)}var n=window.location.search.substring(1);var o=n.split("&");for(var p=0;p<o.length;p++){var q=o[p];var r=q.indexOf("=");if(r>0){h[q.substring(0,r)]=decodeURIComponent(q.substring(r+1))}}g=e==a.IE||e==a.CHROME&&f<2})();this.getBrowser=function(){return e};this.getBrowserVersion=function(){return f};this.getElement=function(a){if(typeof a=="string"){a=document.getElementById(a)}return a};this.getElementPosition=function(a){var a=b.getElement(a);var c=new Seadragon.Point;var d=b.getElementStyle(a).position=="fixed";var e=i(a,d);while(e){c.x+=a.offsetLeft;c.y+=a.offsetTop;if(d){c=c.plus(b.getPageScroll())}a=e;d=b.getElementStyle(a).position=="fixed";e=i(a,d)}return c};this.getElementSize=function(a){var a=b.getElement(a);return new Seadragon.Point(a.clientWidth,a.clientHeight)};this.getElementStyle=function(a){var a=b.getElement(a);if(a.currentStyle){return a.currentStyle}else if(window.getComputedStyle){return window.getComputedStyle(a,"")}else{Seadragon.Debug.fail("Unknown element style, no known technique.")}};this.getEvent=function(a){return a?a:window.event};this.getMousePosition=function(a){var a=b.getEvent(a);var c=new Seadragon.Point;if(typeof a.pageX=="number"){c.x=a.pageX;c.y=a.pageY}else if(typeof a.clientX=="number"){c.x=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;c.y=a.clientY+document.body.scrollTop+document.documentElement.scrollTop}else{Seadragon.Debug.fail("Unknown event mouse position, no known technique.")}return c};this.getPageScroll=function(){var a=new Seadragon.Point;var b=document.documentElement||{};var c=document.body||{};if(typeof window.pageXOffset=="number"){a.x=window.pageXOffset;a.y=window.pageYOffset}else if(c.scrollLeft||c.scrollTop){a.x=c.scrollLeft;a.y=c.scrollTop}else if(b.scrollLeft||b.scrollTop){a.x=b.scrollLeft;a.y=b.scrollTop}return a};this.getWindowSize=function(){var a=new Seadragon.Point;var b=document.documentElement||{};var c=document.body||{};if(typeof window.innerWidth=="number"){a.x=window.innerWidth;a.y=window.innerHeight}else if(b.clientWidth||b.clientHeight){a.x=b.clientWidth;a.y=b.clientHeight}else if(c.clientWidth||c.clientHeight){a.x=c.clientWidth;a.y=c.clientHeight}else{Seadragon.Debug.fail("Unknown window size, no known technique.")}return a};this.imageFormatSupported=function(a){var a=a?a:"";return!!d[a.toLowerCase()]};this.makeCenteredNode=function(a){var a=Seadragon.Utils.getElement(a);var c=b.makeNeutralElement("div");var d=[];d.push('<div style="display:table; height:100%; width:100%;');d.push("border:none; margin:0px; padding:0px;");d.push('#position:relative; overflow:hidden; text-align:left;">');d.push('<div style="#position:absolute; #top:50%; width:100%; ');d.push("border:none; margin:0px; padding:0px;");d.push('display:table-cell; vertical-align:middle;">');d.push('<div style="#position:relative; #top:-50%; width:100%; ');d.push("border:none; margin:0px; padding:0px;");d.push('text-align:center;"></div></div></div>');c.innerHTML=d.join("");c=c.firstChild;var e=c;var f=c.getElementsByTagName("div");while(f.length>0){e=f[0];f=e.getElementsByTagName("div")}e.appendChild(a);return c};this.makeNeutralElement=function(a){var b=document.createElement(a);var c=b.style;c.background="transparent none";c.border="none";c.margin="0px";c.padding="0px";c.position="static";return b};this.makeTransparentImage=function(c){var d=b.makeNeutralElement("img");var g=null;if(e==a.IE&&f<7){g=b.makeNeutralElement("span");g.style.display="inline-block";d.onload=function(){g.style.width=g.style.width||d.width+"px";g.style.height=g.style.height||d.height+"px";d.onload=null;d=null};d.src=c;g.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+c+"', sizingMethod='scale')"}else{g=d;g.src=c}return g};this.setElementOpacity=function(a,c,d){var a=b.getElement(a);if(d&&g){c=Math.round(c)}if(c<1){a.style.opacity=c}else{a.style.opacity=""}if(c==1){var e=a.style.filter||"";a.style.filter=e.replace(/alpha\(.*?\)/g,"");return}var f=Math.round(100*c);var h=" alpha(opacity="+f+") ";try{if(a.filters&&a.filters.alpha){a.filters.alpha.opacity=f}else{a.style.filter+=h}}catch(i){a.style.filter+=h}};this.addEvent=function(a,c,d,e){var a=b.getElement(a);if(a.addEventListener){a.addEventListener(c,d,e)}else if(a.attachEvent){a.attachEvent("on"+c,d);if(e&&a.setCapture){a.setCapture()}}else{Seadragon.Debug.fail("Unable to attach event handler, no known technique.")}};this.removeEvent=function(a,c,d,e){var a=b.getElement(a);if(a.removeEventListener){a.removeEventListener(c,d,e)}else if(a.detachEvent){a.detachEvent("on"+c,d);if(e&&a.releaseCapture){a.releaseCapture()}}else{Seadragon.Debug.fail("Unable to detach event handler, no known technique.")}};this.cancelEvent=function(a){var a=b.getEvent(a);if(a.preventDefault){a.preventDefault()}a.cancel=true;a.returnValue=false};this.stopEvent=function(a){var a=b.getEvent(a);if(a.stopPropagation){a.stopPropagation()}a.cancelBubble=true};this.createCallback=function(a,b){var c=[];for(var d=2;d<arguments.length;d++){c.push(arguments[d])}return function(){var d=c.concat([]);for(var e=0;e<arguments.length;e++){d.push(arguments[e])}return b.apply(a,d)}};this.getUrlParameter=function(a){var b=h[a];return b?b:null};this.makeAjaxRequest=function(a,b){var d=typeof b=="function";var e=null;if(d){var f=b;var b=function(){window.setTimeout(Seadragon.Utils.createCallback(null,f,e),1)}}if(window.ActiveXObject){for(var g=0;g<c.length;g++){try{e=new ActiveXObject(c[g]);break}catch(h){continue}}}else if(window.XMLHttpRequest){e=new XMLHttpRequest}if(!e){Seadragon.Debug.fail("Browser doesn't support XMLHttpRequest.")}if(d){e.onreadystatechange=function(){if(e.readyState==4){e.onreadystatechange=new function(){};b()}}}try{e.open("GET",a,d);e.send(null)}catch(h){Seadragon.Debug.log(h.name+" while making AJAX request: "+h.message);e.onreadystatechange=null;e=null;if(d){b()}}return d?null:e};this.parseXml=function(a){var b=null;if(window.ActiveXObject){try{b=new ActiveXObject("Microsoft.XMLDOM");b.async=false;b.loadXML(a)}catch(c){Seadragon.Debug.log(c.name+" while parsing XML (ActiveX): "+c.message)}}else if(window.DOMParser){try{var d=new DOMParser;b=d.parseFromString(a,"text/xml")}catch(c){Seadragon.Debug.log(c.name+" while parsing XML (DOMParser): "+c.message)}}else{Seadragon.Debug.fail("Browser doesn't support XML DOM.")}return b}};Seadragon.Utils=new Seadragon.Utils;(function(){function j(){b=false}function i(){b=true}function h(a,b){var c=document.body;while(b&&a!=b&&c!=b){try{b=b.parentNode}catch(d){return false}}return a==b}function g(a,b){var c=Seadragon.Utils.getMousePosition(a);var d=Seadragon.Utils.getElementPosition(b);return c.minus(d)}function f(a){return Seadragon.Utils.getMousePosition(a)}if(Seadragon.MouseTracker){return}var a=Seadragon.Utils.getBrowser()==Seadragon.Browser.IE;var b=false;var c=false;var d={};var e=[];(function(){if(a){Seadragon.Utils.addEvent(document,"mousedown",i,false);Seadragon.Utils.addEvent(document,"mouseup",j,false)}else{Seadragon.Utils.addEvent(window,"mousedown",i,true);Seadragon.Utils.addEvent(window,"mouseup",j,true)}})();Seadragon.MouseTracker=function(i,j,k){function L(a){for(var b=0;b<e.length;b++){e[b].onMouseMove(a)}Seadragon.Utils.stopEvent(a)}function K(a){var a=Seadragon.Utils.getEvent(a);var b=f(a);var c=b.minus(s);s=b;if(typeof l.dragHandler=="function"){try{l.dragHandler(l,g(a,i),c,a.shiftKey)}catch(d){Seadragon.Debug.error(d.name+" while executing drag handler: "+d.message,d)}Seadragon.Utils.cancelEvent(a)}}function J(a){var a=Seadragon.Utils.getEvent(a);if(a.button==2){return}var b=(new Date).getTime()-t;var c=f(a);var d=u.distanceTo(c);var e=b<=j&&d<=k;if(typeof l.clickHandler=="function"){try{l.clickHandler(l,g(a,i),e,a.shiftKey)}catch(h){Seadragon.Debug.error(h.name+" while executing click handler: "+h.message,h)}}}function I(a){var b=0;if(!a){a=window.event}if(a.wheelDelta){b=a.wheelDelta;if(window.opera){b=-b}}else if(a.detail){b=-a.detail}b=b>0?1:-1;if(typeof l.scrollHandler=="function"){try{l.scrollHandler(l,g(a,i),b,a.shiftKey)}catch(c){Seadragon.Debug.error(c.name+" while executing scroll handler: "+c.message,c)}Seadragon.Utils.cancelEvent(a)}}function H(a){if(l.clickHandler){Seadragon.Utils.cancelEvent(a)}}function G(a){if(!r){E(a)}y()}function F(a){var a=Seadragon.Utils.getEvent(a);if(a.button==2){return}for(var b=0;b<e.length;b++){var d=e[b];if(!d.hasMouse()){d.onMouseUp(a)}}y();c=false;a.srcElement.fireEvent("on"+a.type,document.createEventObject(a));Seadragon.Utils.stopEvent(a)}function E(a){var a=Seadragon.Utils.getEvent(a);var b=q;var c=r;if(a.button==2){return}q=false;if(typeof l.releaseHandler=="function"){try{l.releaseHandler(l,g(a,i),b,c)}catch(d){Seadragon.Debug.error(d.name+" while executing release handler: "+d.message,d)}}if(b&&c){J(a)}}function D(b){var b=Seadragon.Utils.getEvent(b);if(b.button==2){return}q=true;s=f(b);u=s;t=(new Date).getTime();if(typeof l.pressHandler=="function"){try{l.pressHandler(l,g(b,i))}catch(d){Seadragon.Debug.error(d.name+" while executing press handler: "+d.message,d)}}if(l.pressHandler||l.dragHandler){Seadragon.Utils.cancelEvent(b)}if(!a||!c){x();c=true;e=[m]}else if(a){e.push(m)}}function C(c){var c=Seadragon.Utils.getEvent(c);if(a&&p&&!h(c.srcElement,i)){z("onMouseOut",c)}var d=c.target?c.target:c.srcElement;var e=c.relatedTarget?c.relatedTarget:c.toElement;if(!h(i,d)||h(i,e)){return}r=false;if(typeof l.exitHandler=="function"){try{l.exitHandler(l,g(c,i),q,b)}catch(f){Seadragon.Debug.error(f.name+" while executing exit handler: "+f.message,f)}}}function B(c){var c=Seadragon.Utils.getEvent(c);if(a&&p&&!h(c.srcElement,i)){z("onMouseOver",c)}var d=c.target?c.target:c.srcElement;var e=c.relatedTarget?c.relatedTarget:c.fromElement;if(!h(i,d)||h(i,e)){return}r=true;if(typeof l.enterHandler=="function"){try{l.enterHandler(l,g(c,i),q,b)}catch(f){Seadragon.Debug.error(f.name+" while executing enter handler: "+f.message,f)}}}function A(){return r}function z(a,b){var c=d;for(var e in c){if(c.hasOwnProperty(e)&&n!=e){c[e][a](b)}}}function y(){if(p){if(a){Seadragon.Utils.removeEvent(i,"mousemove",L,true);Seadragon.Utils.removeEvent(i,"mouseup",F,true);Seadragon.Utils.addEvent(i,"mouseup",E,false)}else{Seadragon.Utils.removeEvent(window,"mousemove",K,true);Seadragon.Utils.removeEvent(window,"mouseup",G,true)}p=false}}function x(){if(!p){if(a){Seadragon.Utils.removeEvent(i,"mouseup",E,false);Seadragon.Utils.addEvent(i,"mouseup",F,true);Seadragon.Utils.addEvent(i,"mousemove",L,true)}else{Seadragon.Utils.addEvent(window,"mouseup",G,true);Seadragon.Utils.addEvent(window,"mousemove",K,true)}p=true}}function w(){if(o){Seadragon.Utils.removeEvent(i,"mouseover",B,false);Seadragon.Utils.removeEvent(i,"mouseout",C,false);Seadragon.Utils.removeEvent(i,"mousedown",D,false);Seadragon.Utils.removeEvent(i,"mouseup",E,false);Seadragon.Utils.removeEvent(i,"click",H,false);Seadragon.Utils.removeEvent(i,"DOMMouseScroll",I,false);Seadragon.Utils.removeEvent(i,"mousewheel",I,false);y();o=false;delete d[n]}}function v(){if(!o){Seadragon.Utils.addEvent(i,"mouseover",B,false);Seadragon.Utils.addEvent(i,"mouseout",C,false);Seadragon.Utils.addEvent(i,"mousedown",D,false);Seadragon.Utils.addEvent(i,"mouseup",E,false);Seadragon.Utils.addEvent(i,"click",H,false);Seadragon.Utils.addEvent(i,"DOMMouseScroll",I,false);Seadragon.Utils.addEvent(i,"mousewheel",I,false);o=true;d[n]=m}}var l=this;var m=null;var n=Math.random();var i=Seadragon.Utils.getElement(i);var o=false;var p=false;var q=false;var r=false;var s=null;var t=null;var u=null;var j=j;var k=k;this.target=i;this.enterHandler=null;this.exitHandler=null;this.pressHandler=null;this.releaseHandler=null;this.scrollHandler=null;this.clickHandler=null;this.dragHandler=null;(function(){m={hasMouse:A,onMouseOver:B,onMouseOut:C,onMouseUp:E,onMouseMove:K}})();this.isTracking=function(){return o};this.setTracking=function(a){if(a){v()}else{w()}}}})();if(!window.SIGNAL)window.SIGNAL="----seadragon----";Seadragon.ControlAnchor=function(){throw Error.invalidOperation()};Seadragon.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4};Seadragon.ControlAnchor=Seadragon.ControlAnchor;Seadragon.OverlayPlacement=function(){throw Error.invalidOperation()};Seadragon.OverlayPlacement={CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8};Seadragon.OverlayPlacement=Seadragon.OverlayPlacement;Seadragon.NavControl=function(a){this._group=null;this._zooming=false;this._zoomFactor=null;this._lastZoomTime=null;this._viewer=a;this.config=this._viewer.config;this.elmt=null;this.initialize()};Seadragon.NavControl.prototype={initialize:function(){var a=Function.createDelegate(this,this._beginZoomingIn);var b=Function.createDelegate(this,this._endZooming);var c=Function.createDelegate(this,this._doSingleZoomIn);var d=Function.createDelegate(this,this._beginZoomingOut);var e=Function.createDelegate(this,this._doSingleZoomOut);var f=Function.createDelegate(this,this._onHome);var g=Function.createDelegate(this,this._onFullPage);var h=this._viewer.config.navImages;var i=new Seadragon.Button({config:this._viewer.config,tooltip:Seadragon.Strings.getString("Tooltips.ZoomIn"),srcRest:this._resolveUrl(h.zoomIn.REST),srcGroup:this._resolveUrl(h.zoomIn.GROUP),srcHover:this._resolveUrl(h.zoomIn.HOVER),srcDown:this._resolveUrl(h.zoomIn.DOWN)},{onPress:a,onRelease:b,onClick:c,onEnter:a,onExit:b});var j=new Seadragon.Button({config:this._viewer.config,tooltip:Seadragon.Strings.getString("Tooltips.ZoomOut"),srcRest:this._resolveUrl(h.zoomOut.REST),srcGroup:this._resolveUrl(h.zoomOut.GROUP),srcHover:this._resolveUrl(h.zoomOut.HOVER),srcDown:this._resolveUrl(h.zoomOut.DOWN)},{onPress:d,onRelease:b,onClick:e,onEnter:d,onExit:b});var k=new Seadragon.Button({config:this._viewer.config,tooltip:Seadragon.Strings.getString("Tooltips.Home"),srcRest:this._resolveUrl(h.home.REST),srcGroup:this._resolveUrl(h.home.GROUP),srcHover:this._resolveUrl(h.home.HOVER),srcDown:this._resolveUrl(h.home.DOWN)},{onRelease:f});var l=new Seadragon.Button({config:this._viewer.config,tooltip:Seadragon.Strings.getString("Tooltips.FullPage"),srcRest:this._resolveUrl(h.fullpage.REST),srcGroup:this._resolveUrl(h.fullpage.GROUP),srcHover:this._resolveUrl(h.fullpage.HOVER),srcDown:this._resolveUrl(h.fullpage.DOWN)},{onRelease:g});this._group=new Seadragon.ButtonGroup({config:this._viewer.config,buttons:[i,j,k,l]});this.elmt=this._group.get_element();this.elmt[SIGNAL]=true;this._viewer.add_open(Function.createDelegate(this,this._lightUp))},dispose:function(){},get_events:function(){return this._events},set_events:function(a){this._events=a},_resolveUrl:function(a){return String.format("{1}",this._viewer.get_prefixUrl(),a)},_beginZoomingIn:function(){this._lastZoomTime=(new Date).getTime();this._zoomFactor=this.config.zoomPerSecond;this._zooming=true;this._scheduleZoom()},_beginZoomingOut:function(){this._lastZoomTime=(new Date).getTime();this._zoomFactor=1/this.config.zoomPerSecond;this._zooming=true;this._scheduleZoom()},_endZooming:function(){this._zooming=false},_scheduleZoom:function(){window.setTimeout(Function.createDelegate(this,this._doZoom),10)},_doZoom:function(){if(this._zooming&&this._viewer.viewport){var a=(new Date).getTime();var b=a-this._lastZoomTime;var c=Math.pow(this._zoomFactor,b/1e3);this._viewer.viewport.zoomBy(c);this._viewer.viewport.applyConstraints();this._lastZoomTime=a;this._scheduleZoom()}},_doSingleZoomIn:function(){if(this._viewer.viewport){this._zooming=false;this._viewer.viewport.zoomBy(this.config.zoomPerClick/1);this._viewer.viewport.applyConstraints()}},_doSingleZoomOut:function(){if(this._viewer.viewport){this._zooming=false;this._viewer.viewport.zoomBy(1/this.config.zoomPerClick);this._viewer.viewport.applyConstraints()}},_lightUp:function(){this._group.emulateEnter();this._group.emulateExit()},_onHome:function(){if(this._viewer.viewport){this._viewer.viewport.goHome()}},_onFullPage:function(){this._viewer.setFullPage(!this._viewer.isFullPage());this._group.emulateExit();if(this._viewer.viewport){this._viewer.viewport.applyConstraints()}if(this._viewer.onFullPage){this._viewer.onFullPage.apply(this._viewer)}}};Seadragon.Control=function(a,b,c){this.elmt=a;this.anchor=b;this.container=c;this.wrapper=Seadragon.Utils.makeNeutralElement("span");this.wrapper.style.display="inline-block";this.wrapper.appendChild(this.elmt);if(this.anchor==Seadragon.ControlAnchor.NONE){this.wrapper.style.width=this.wrapper.style.height="100%"}if(this.anchor==Seadragon.ControlAnchor.TOP_RIGHT||this.anchor==Seadragon.ControlAnchor.BOTTOM_RIGHT){this.container.insertBefore(this.wrapper,this.container.firstChild)}else{this.container.appendChild(this.wrapper)}};Seadragon.Control.prototype={destroy:function(){this.wrapper.removeChild(this.elmt);this.container.removeChild(this.wrapper)},isVisible:function(){return this.wrapper.style.display!="none"},setVisible:function(a){this.wrapper.style.display=a?"inline-block":"none"},setOpacity:function(a){if(this.elmt[SIGNAL]&&Seadragon.Utils.getBrowser()==Seadragon.Browser.IE){Seadragon.Utils.setElementOpacity(this.elmt,a,true)}else{Seadragon.Utils.setElementOpacity(this.wrapper,a,true)}}};Seadragon.Viewer=function(a,b,c,d,e,f){this.config=new Seadragon.Config;this._prefixUrl=c?c:"";this._element=document.getElementById(a);this._controls=d?d:[];this._customControls=[];this._overlays=e?e:[];this._overlayControls=f?f:[];this._container=null;this._canvas=null;this._controlsTL=null;this._controlsTR=null;this._controlsBR=null;this._controlsBL=null;this._bodyWidth=null;this._bodyHeight=null;this._bodyOverflow=null;this._docOverflow=null;this._fsBoundsDelta=null;this._prevContainerSize=null;this._lastOpenStartTime=0;this._lastOpenEndTime=0;this._animating=false;this._forceRedraw=false;this._mouseInside=false;this._xmlPath=b?b:undefined;this.source=null;this.drawer=null;this.viewport=null;this.profiler=null;this.initialize()};Seadragon.Viewer.prototype={initialize:function(){this._observer=new Observer;this._container=Seadragon.Utils.makeNeutralElement("div");this._canvas=Seadragon.Utils.makeNeutralElement("div");this._controlsTL=Seadragon.Utils.makeNeutralElement("div");this._controlsTR=Seadragon.Utils.makeNeutralElement("div");this._controlsBR=Seadragon.Utils.makeNeutralElement("div");this._controlsBL=Seadragon.Utils.makeNeutralElement("div");var a=new Seadragon.MouseTracker(this._canvas,this.config.clickTimeThreshold,this.config.clickDistThreshold);var b=new Seadragon.MouseTracker(this._container,this.config.clickTimeThreshold,this.config.clickDistThreshold);this._bodyWidth=document.body.style.width;this._bodyHeight=document.body.style.height;this._bodyOverflow=document.body.style.overflow;this._docOverflow=document.documentElement.style.overflow;this._fsBoundsDelta=new Seadragon.Point(1,1);var c=this._canvas.style;var d=this._container.style;var e=this._controlsTL.style;var f=this._controlsTR.style;var g=this._controlsBR.style;var h=this._controlsBL.style;d.width="100%";d.height="100%";d.position="relative";d.left="0px";d.top="0px";d.textAlign="left";c.width="100%";c.height="100%";c.overflow="hidden";c.position="absolute";c.top="0px";c.left="0px";e.position=f.position=g.position=h.position="absolute";e.top=f.top="0px";e.left=h.left="0px";f.right=g.right="0px";h.bottom=g.bottom="0px";a.clickHandler=Function.createDelegate(this,this._onCanvasClick);a.dragHandler=Function.createDelegate(this,this._onCanvasDrag);a.releaseHandler=Function.createDelegate(this,this._onCanvasRelease);a.scrollHandler=Function.createDelegate(this,this._onCanvasScroll);a.setTracking(true);if(this.get_showNavigationControl()){navControl=(new Seadragon.NavControl(this)).elmt;navControl.style.marginRight="4px";navControl.style.marginBottom="4px";this.addControl(navControl,Seadragon.ControlAnchor.BOTTOM_RIGHT)}for(var i=0;i<this._customControls.length;i++){this.addControl(this._customControls[i].id,this._customControls[i].anchor)}b.enterHandler=Function.createDelegate(this,this._onContainerEnter);b.exitHandler=Function.createDelegate(this,this._onContainerExit);b.releaseHandler=Function.createDelegate(this,this._onContainerRelease);b.setTracking(true);window.setTimeout(Function.createDelegate(this,this._beginControlsAutoHide),1);this._container.appendChild(this._canvas);this._container.appendChild(this._controlsTL);this._container.appendChild(this._controlsTR);this._container.appendChild(this._controlsBR);this._container.appendChild(this._controlsBL);this.get_element().appendChild(this._container);if(this._xmlPath)this.openDzi(this._xmlPath)},get_events:function b(){return this._observer._getContext(this,true).events},_raiseEvent:function(a,b){var c=this.get_events().getHandler(a);if(c){if(!b){b=new Object}c(this,b)}},_beginControlsAutoHide:function(){if(!this.config.autoHideControls){return}this._controlsShouldFade=true;this._controlsFadeBeginTime=(new Date).getTime()+this._controlsFadeDelay;window.setTimeout(Function.createDelegate(this,this._scheduleControlsFade),this._controlsFadeDelay)},_scheduleControlsFade:function(){window.setTimeout(Function.createDelegate(this,this._updateControlsFade),20)},_updateControlsFade:function(){if(this._controlsShouldFade){var a=(new Date).getTime();var b=a-this._controlsFadeBeginTime;var c=1-b/this._controlsFadeLength;c=Math.min(1,c);c=Math.max(0,c);for(var d=this._controls.length-1;d>=0;d--){this._controls[d].setOpacity(c)}if(c>0){this._scheduleControlsFade()}}},_onCanvasClick:function(a,b,c,d){if(this.viewport&&c){var e=this.config.zoomPerClick;var f=d?1/e:e;this.viewport.zoomBy(f,this.viewport.pointFromPixel(b,true));this.viewport.applyConstraints()}},_onCanvasDrag:function(a,b,c,d){if(this.viewport){this.viewport.panBy(this.viewport.deltaPointsFromPixels(c.negate()))}},_onCanvasRelease:function(a,b,c,d){if(c&&this.viewport){this.viewport.applyConstraints()}},_onCanvasScroll:function(a,b,c,d){if(this.viewport){var e=Math.pow(this.config.zoomPerScroll,c);this.viewport.zoomBy(e,this.viewport.pointFromPixel(b,true));this.viewport.applyConstraints()}},_onContainerExit:function(a,b,c,d){if(!c){this._mouseInside=false;if(!this._animating){this._beginControlsAutoHide()}}},_onContainerRelease:function(a,b,c,d){if(!d){this._mouseInside=false;if(!this._animating){this._beginControlsAutoHide()}}},_getControlIndex:function(a){for(var b=this._controls.length-1;b>=0;b--){if(this._controls[b].elmt==a){return b}}return-1},_abortControlsAutoHide:function(){this._controlsShouldFade=false;for(var a=this._controls.length-1;a>=0;a--){this._controls[a].setOpacity(1)}},_onContainerEnter:function(a,b,c,d){this._mouseInside=true;this._abortControlsAutoHide()},_updateOnce:function(){if(!this.source){return}this.profiler.beginUpdate();var a=Seadragon.Utils.getElementSize(this._container);if(!a.equals(this._prevContainerSize)){this.viewport.resize(a,true);this._prevContainerSize=a;this._raiseEvent("resize",this)}var b=this.viewport.update();if(!this._animating&&b){this._raiseEvent("animationstart",self);this._abortControlsAutoHide()}if(b){this.drawer.update();this._raiseEvent("animation",self)}else if(this._forceRedraw||this.drawer.needsUpdate()){this.drawer.update();this._forceRedraw=false}else{this.drawer.idle()}if(this._animating&&!b){this._raiseEvent("animationfinish",this);if(!this._mouseInside){this._beginControlsAutoHide()}}this._animating=b;this.profiler.endUpdate()},_onClose:function(){this.source=null;this.viewport=null;this.drawer=null;this.profiler=null;this._canvas.innerHTML=""},_beforeOpen:function(){if(this.source){this._onClose()}this._lastOpenStartTime=(new Date).getTime();window.setTimeout(Function.createDelegate(this,function(){if(this._lastOpenStartTime>this._lastOpenEndTime){this._setMessage(Seadragon.Strings.getString("Messages.Loading"))}}),2e3);return this._lastOpenStartTime},_setMessage:function(a){var b=document.createTextNode(a);this._canvas.innerHTML="";this._canvas.appendChild(Seadragon.Utils.makeCenteredNode(b));var c=b.parentNode.style;c.color="white";c.fontFamily="verdana";c.fontSize="13px";c.fontSizeAdjust="none";c.fontStyle="normal";c.fontStretch="normal";c.fontVariant="normal";c.fontWeight="normal";c.lineHeight="1em";c.textAlign="center";c.textDecoration="none"},_onOpen:function(a,b,c){this._lastOpenEndTime=(new Date).getTime();if(a<this._lastOpenStartTime){Seadragon.Debug.log("Ignoring out-of-date open.");this._raiseEvent("ignore");return}else if(!b){this._setMessage(c);this._raiseEvent("error");return}this._canvas.innerHTML="";this._prevContainerSize=Seadragon.Utils.getElementSize(this._container);this.source=b;this.viewport=new Seadragon.Viewport(this._prevContainerSize,this.source.dimensions,this.config);this.drawer=new Seadragon.Drawer(this.source,this.viewport,this._canvas);this.profiler=new Seadragon.Profiler;this._animating=false;this._forceRedraw=true;this._scheduleUpdate(this._updateMulti);for(var d=0;d<this._overlayControls.length;d++){var e=this._overlayControls[d];if(e.point!=null){this.drawer.addOverlay(e.id,new Seadragon.Point(e.point.X,e.point.Y),Seadragon.OverlayPlacement.TOP_LEFT)}else{this.drawer.addOverlay(e.id,new Seadragon.Rect(e.rect.Point.X,e.rect.Point.Y,e.rect.Width,e.rect.Height),e.placement)}}this._raiseEvent("open")},_scheduleUpdate:function(a,b){if(this._animating){return window.setTimeout(Function.createDelegate(this,a),1)}var c=(new Date).getTime();var b=b?b:c;var d=b+1e3/60;var e=Math.max(1,d-c);return window.setTimeout(Function.createDelegate(this,a),e)},_updateMulti:function(){if(!this.source){return}var a=(new Date).getTime();this._updateOnce();this._scheduleUpdate(arguments.callee,a)},_updateOnce:function(){if(!this.source){return}this.profiler.beginUpdate();var a=Seadragon.Utils.getElementSize(this._container);if(!a.equals(this._prevContainerSize)){this.viewport.resize(a,true);this._prevContainerSize=a;this._raiseEvent("resize")}var b=this.viewport.update();if(!this._animating&&b){this._raiseEvent("animationstart");this._abortControlsAutoHide()}if(b){this.drawer.update();this._raiseEvent("animation")}else if(this._forceRedraw||this.drawer.needsUpdate()){this.drawer.update();this._forceRedraw=false}else{this.drawer.idle()}if(this._animating&&!b){this._raiseEvent("animationfinish");if(!this._mouseInside){this._beginControlsAutoHide()}}this._animating=b;this.profiler.endUpdate()},getNavControl:function(){return this._navControl},get_element:function(){return this._element},get_xmlPath:function(){return this._xmlPath},set_xmlPath:function(a){this._xmlPath=a},get_debugMode:function(){return this.config.debugMode},set_debugMode:function(a){this.config.debugMode=a},get_animationTime:function(){return this.config.animationTime},set_animationTime:function(a){this.config.animationTime=a},get_blendTime:function(){return this.config.blendTime},set_blendTime:function(a){this.config.blendTime=a},get_alwaysBlend:function(){return this.config.alwaysBlend},set_alwaysBlend:function(a){this.config.alwaysBlend=a},get_autoHideControls:function(){return this.config.autoHideControls},set_autoHideControls:function(a){this.config.autoHideControls=a},get_immediateRender:function(){return this.config.immediateRender},set_immediateRender:function(a){this.config.immediateRender=a},get_wrapHorizontal:function(){return this.config.wrapHorizontal},set_wrapHorizontal:function(a){this.config.wrapHorizontal=a},get_wrapVertical:function(){return this.config.wrapVertical},set_wrapVertical:function(a){this.config.wrapVertical=a},get_minZoomImageRatio:function(){return this.config.minZoomImageRatio},set_minZoomImageRatio:function(a){this.config.minZoomImageRatio=a},get_maxZoomPixelRatio:function(){return this.config.maxZoomPixelRatio},set_maxZoomPixelRatio:function(a){this.config.maxZoomPixelRatio=a},get_visibilityRatio:function(){return this.config.visibilityRatio},set_visibilityRatio:function(a){this.config.visibilityRatio=a},get_springStiffness:function(){return this.config.springStiffness},set_springStiffness:function(a){this.config.springStiffness=a},get_imageLoaderLimit:function(){return this.config.imageLoaderLimit},set_imageLoaderLimit:function(a){this.config.imageLoaderLimit=a},get_clickTimeThreshold:function(){return this.config.clickTimeThreshold},set_clickTimeThreshold:function(a){this.config.clickTimeThreshold=a},get_clickDistThreshold:function(){return this.config.clickDistThreshold},set_clickDistThreshold:function(a){this.config.clickDistThreshold=a},get_zoomPerClick:function(){return this.config.zoomPerClick},set_zoomPerClick:function(a){this.config.zoomPerClick=a},get_zoomPerSecond:function(){return this.config.zoomPerSecond},set_zoomPerSecond:function(a){this.config.zoomPerSecond=a},get_zoomPerScroll:function(){return this.config.zoomPerScroll},set_zoomPerScroll:function(a){this.config.zoomPerScroll=a},get_maxImageCacheCount:function(){return this.config.maxImageCacheCount},set_maxImageCacheCount:function(a){this.config.maxImageCacheCount=a},get_showNavigationControl:function(){return this.config.showNavigationControl},set_showNavigationControl:function(a){this.config.showNavigationControl=a},get_minPixelRatio:function(){return this.config.minPixelRatio},set_minPixelRatio:function(a){this.config.minPixelRatio=a},get_mouseNavEnabled:function(){return this.config.mouseNavEnabled},set_mouseNavEnabled:function(a){this.config.mouseNavEnabled=a},get_controls:function(){return this._customControls},set_controls:function(a){this._customControls=a},get_overlays:function(){return this._overlayControls},set_overlays:function(a){this._overlayControls=a},get_prefixUrl:function(){return this._prefixUrl},set_prefixUrl:function(a){this._prefixUrl=a},add_open:function(a){this.get_events().addHandler("open",a)},remove_open:function(a){this.get_events().removeHandler("open",a)},add_error:function(a){this.get_events().addHandler("error",a)},remove_error:function(a){this.get_events().removeHandler("error",a)},add_ignore:function(a){this.get_events().addHandler("ignore",a)},remove_ignore:function(a){this.get_events().removeHandler("ignore",a)},add_resize:function(a){this.get_events().addHandler("resize",a)},remove_resize:function(a){this.get_events().removeHandler("resize",a)},add_animationstart:function(a){this.get_events().addHandler("animationstart",a)},remove_animationstart:function(a){this.get_events().removeHandler("animationstart",a)},add_animation:function(a){this.get_events().addHandler("animation",a)},remove_animation:function(a){this.get_events().removeHandler("animation",a)},add_animationfinish:function(a){this.get_events().addHandler("animationfinish",a)},remove_animationfinish:function(a){this.get_events().removeHandler("animationfinish",a)},addControl:function(a,b){var a=Seadragon.Utils.getElement(a);if(this._getControlIndex(a)>=0){return}var c=null;switch(b){case Seadragon.ControlAnchor.TOP_RIGHT:c=this._controlsTR;a.style.position="relative";break;case Seadragon.ControlAnchor.BOTTOM_RIGHT:c=this._controlsBR;a.style.position="relative";break;case Seadragon.ControlAnchor.BOTTOM_LEFT:c=this._controlsBL;a.style.position="relative";break;case Seadragon.ControlAnchor.TOP_LEFT:c=this._controlsTL;a.style.position="relative";break;case Seadragon.ControlAnchor.NONE:default:c=this._container;a.style.position="absolute";break}this._controls.push(new Seadragon.Control(a,b,c));a.style.display="inline-block"},isOpen:function(){return!!this.source},openDzi:function(a,b){var c=this._beforeOpen();Seadragon.DziTileSourceHelper.createFromXml(a,b,Seadragon.Utils.createCallback(null,Function.createDelegate(this,this._onOpen),c))},openTileSource:function(a){var b=beforeOpen();window.setTimeout(Function.createDelegate(this,function(){onOpen(b,a)}),1)},close:function(){if(!this.source){return}this._onClose()},removeControl:function(a){var a=Seadragon.Utils.getElement(a);var b=this._getControlIndex(a);if(b>=0){this._controls[b].destroy();this._controls.splice(b,1)}},clearControls:function(){while(this._controls.length>0){this._controls.pop().destroy()}},isDashboardEnabled:function(){for(var a=this._controls.length-1;a>=0;a--){if(this._controls[a].isVisible()){return true}}return false},isFullPage:function(){return this._container.parentNode==document.body},isMouseNavEnabled:function(){return this._innerTracker.isTracking()},isVisible:function(){return this._container.style.visibility!="hidden"},setDashboardEnabled:function(a){for(var b=this._controls.length-1;b>=0;b--){this._controls[b].setVisible(a)}},setFullPage:function(a){if(a==this.isFullPage()){return}var b=document.body;var c=b.style;var d=document.documentElement.style;var e=this._container.style;var f=this._canvas.style;if(a){bodyOverflow=c.overflow;docOverflow=d.overflow;c.overflow="hidden";d.overflow="hidden";bodyWidth=c.width;bodyHeight=c.height;c.width="100%";c.height="100%";f.backgroundColor="black";f.color="white";e.position="fixed";e.zIndex="99999999";b.appendChild(this._container);this._prevContainerSize=Seadragon.Utils.getWindowSize();this._onContainerEnter()}else{c.overflow=bodyOverflow;d.overflow=docOverflow;c.width=bodyWidth;c.height=bodyHeight;f.backgroundColor="";f.color="";e.position="relative";e.zIndex="";this.get_element().appendChild(this._container);this._prevContainerSize=Seadragon.Utils.getElementSize(this.get_element());this._onContainerExit()}if(this.viewport){var g=this.viewport.getBounds();this.viewport.resize(this._prevContainerSize);var h=this.viewport.getBounds();if(a){this._fsBoundsDelta=new Seadragon.Point(h.width/g.width,h.height/g.height)}else{this.viewport.update();this.viewport.zoomBy(Math.max(this._fsBoundsDelta.x,this._fsBoundsDelta.y),null,true)}this._forceRedraw=true;this._raiseEvent("resize",this);this._updateOnce()}},setMouseNavEnabled:function(a){this._innerTracker.setTracking(a)},setVisible:function(a){this._container.style.visibility=a?"":"hidden"}};Seadragon.Strings={Errors:{Failure:SeadragonConfig.Failure?SeadragonConfig.Failure:"Sorry, but Seadragon Ajax can't run on your browser!\n"+"Please try using IE 7 or Firefox 3.\n",Dzc:SeadragonConfig.Dzc?SeadragonConfig.Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:SeadragonConfig.Dzi?SeadragonConfig.Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:SeadragonConfig.Xml?SeadragonConfig.Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Empty:SeadragonConfig.Empty?SeadragonConfig.Empty:"You asked us to open nothing, so we did just that.",ImageFormat:SeadragonConfig.ImageFormat?SeadragonConfig.ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:SeadragonConfig.Security?SeadragonConfig.Security:"It looks like a security restriction stopped us from "+"loading this Deep Zoom Image.",Status:SeadragonConfig.Status?SeadragonConfig.Status:"This space unintentionally left blank ({0} {1}).",Unknown:SeadragonConfig.Unknown?SeadragonConfig.Unknown:"Whoops, something inexplicably went wrong. Sorry!"},Messages:{Loading:SeadragonConfig.Loading?SeadragonConfig.Loading:"Loading..."},Tooltips:{FullPage:SeadragonConfig.FullPage?SeadragonConfig.FullPage:"Exit",Home:SeadragonConfig.Home?SeadragonConfig.Home:"Fit image",ZoomIn:SeadragonConfig.ZoomIn?SeadragonConfig.ZoomIn:"Zoom in",ZoomOut:SeadragonConfig.ZoomOut?SeadragonConfig.ZoomOut:"Zoom out"},getString:function(a){var b=a.split(".");var c=Seadragon.Strings;for(var d=0;d<b.length;d++){c=c[b[d]]||{}}if(typeof c!="string"){c=""}var e=arguments;return c.replace(/\{\d+\}/g,function(a){var b=parseInt(a.match(/\d+/))+1;return b<e.length?e[b]:""})},setString:function(a,b){var c=a.split(".");var d=Seadragon.Strings;for(var e=0;e<c.length-1;e++){if(!d[c[e]]){d[c[e]]={}}d=d[c[e]]}d[c[e]]=b}};Seadragon.Strings=Seadragon.Strings;Seadragon.Point=Seadragon.Point=function(a,b){this.x=typeof a=="number"?a:0;this.y=typeof b=="number"?b:0};Seadragon.Point.prototype={plus:function(a){return new Seadragon.Point(this.x+a.x,this.y+a.y)},minus:function(a){return new Seadragon.Point(this.x-a.x,this.y-a.y)},times:function(a){return new Seadragon.Point(this.x*a,this.y*a)},divide:function(a){return new Seadragon.Point(this.x/a,this.y/a)},negate:function(){return new Seadragon.Point(-this.x,-this.y)},distanceTo:function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},apply:function(a){return new Seadragon.Point(a(this.x),a(this.y))},equals:function(a){return a instanceof Seadragon.Point&&this.x===a.x&&this.y===a.y},toString:function(){return"("+this.x+","+this.y+")"}};Seadragon.Profiler=function(){this._midUpdate=false;this._numUpdates=0;this._lastBeginTime=null;this._lastEndTime=null;this._minUpdateTime=Infinity;this._avgUpdateTime=0;this._maxUpdateTime=0;this._minIdleTime=Infinity;this._avgIdleTime=0;this._maxIdleTime=0};Seadragon.Profiler.prototype={getAvgUpdateTime:function(){return this._avgUpdateTime},getMinUpdateTime:function(){return this._minUpdateTime},getMaxUpdateTime:function(){return this._maxUpdateTime},getAvgIdleTime:function(){return this._avgIdleTime},getMinIdleTime:function(){return this._minIdleTime},getMaxIdleTime:function(){return this._maxIdleTime},isMidUpdate:function(){return this._midUpdate},getNumUpdates:function(){return this._numUpdates},beginUpdate:function(){if(this._midUpdate){this.endUpdate()}this._midUpdate=true;this._lastBeginTime=(new Date).getTime();if(this._numUpdates<1){return}var a=this._lastBeginTime-this._lastEndTime;this._avgIdleTime=(this._avgIdleTime*(this._numUpdates-1)+a)/this._numUpdates;if(a<this._minIdleTime){this._minIdleTime=a}if(a>this._maxIdleTime){this._maxIdleTime=a}},endUpdate:function(){if(!this._midUpdate){return}this._lastEndTime=(new Date).getTime();this._midUpdate=false;var a=this._lastEndTime-this._lastBeginTime;this._numUpdates++;this._avgUpdateTime=(this._avgUpdateTime*(this._numUpdates-1)+a)/this._numUpdates;if(a<this._minUpdateTime){this._minUpdateTime=a}if(a>this._maxUpdateTime){this._maxUpdateTime=a}},clearProfile:function(){this._midUpdate=false;this._numUpdates=0;this._lastBeginTime=null;this._lastEndTime=null;this._minUpdateTime=Infinity;this._avgUpdateTime=0;this._maxUpdateTime=0;this._minIdleTime=Infinity;this._avgIdleTime=0;this._maxIdleTime=0}};Seadragon.Job=function(a,b){this._image=null;this._timeout=null;this._src=a;this._callback=b;this.TIMEOUT=5e3};Seadragon.Job.prototype={_finish:function(a){this._image.onload=null;this._image.onabort=null;this._image.onerror=null;if(this._timeout){window.clearTimeout(this._timeout)}var b=this._image;var c=this._callback;window.setTimeout(function(){c(this._src,a?b:null)},1)},_onloadHandler:function(){this._finish(true)},_onerrorHandler:function(){this._finish(false)},start:function(){this._image=new Image;this._image.onload=Function.createDelegate(this,this._onloadHandler);this._image.onabort=Function.createDelegate(this,this._onerrorHandler);this._image.onerror=Function.createDelegate(this,this._onerrorHandler);this._timeout=window.setTimeout(Function.createDelegate(this,this._onerrorHandler),this.TIMEOUT);this._image.src=this._src}};Seadragon.ImageLoader=function(a){this._downloading=0;this.imageLoaderLimit=a};Seadragon.ImageLoader.prototype={_onComplete:function(a,b,c){this._downloading--;if(typeof a=="function"){try{a(c)}catch(d){Seadragon.Debug.error(d.name+" while executing "+b+" callback: "+d.message,d)}}},loadImage:function(a,b){if(this._downloading>=this.imageLoaderLimit){return false}var c=Seadragon.Utils.createCallback(null,Function.createDelegate(this,this._onComplete),b);var d=new Seadragon.Job(a,c);this._downloading++;d.start();return true}};Seadragon.TileSource=function(a,b,c,d,e,f){this.aspectRatio=a/b;this.dimensions=new Seadragon.Point(a,b);this.minLevel=e?e:0;this.maxLevel=f?f:Math.ceil(Math.log(Math.max(a,b))/Math.log(2));this.tileSize=c?c:0;this.tileOverlap=d?d:0};Seadragon.TileSource.prototype={getLevelScale:function(a){return 1/(1<<this.maxLevel-a)},getNumTiles:function(a){var b=this.getLevelScale(a);var c=Math.ceil(b*this.dimensions.x/this.tileSize);var d=Math.ceil(b*this.dimensions.y/this.tileSize);return new Seadragon.Point(c,d)},getPixelRatio:function(a){var b=this.dimensions.times(this.getLevelScale(a));var c=1/b.x;var d=1/b.y;return new Seadragon.Point(c,d)},getTileAtPoint:function(a,b){var c=b.times(this.dimensions.x).times(this.getLevelScale(a));var d=Math.floor(c.x/this.tileSize);var e=Math.floor(c.y/this.tileSize);return new Seadragon.Point(d,e)},getTileBounds:function(a,b,c){var d=this.dimensions.times(this.getLevelScale(a));var e=b===0?0:this.tileSize*b-this.tileOverlap;var f=c===0?0:this.tileSize*c-this.tileOverlap;var g=this.tileSize+(b===0?1:2)*this.tileOverlap;var h=this.tileSize+(c===0?1:2)*this.tileOverlap;g=Math.min(g,d.x-e);h=Math.min(h,d.y-f);var i=1/d.x;return new Seadragon.Rect(e*i,f*i,g*i,h*i)},getTileUrl:function(a,b,c){throw new Error("Method not implemented.")},tileExists:function(a,b,c){var d=this.getNumTiles(a);return a>=this.minLevel&&a<=this.maxLevel&&b>=0&&c>=0&&b<d.x&&c<d.y}};Seadragon.DziError=function(a){Error.apply(this,arguments);this.message=a};Seadragon.DziError.prototype=new Error;Seadragon.DziError.constructor=Seadragon.DziError;Seadragon.DziTileSource=function(a,b,c,d,e,f,g){Seadragon.TileSource.call(this,a,b,c,d,null,null);this._levelRects={};this.tilesUrl=e;this.fileFormat=f;this.displayRects=g;this.initialize()};Seadragon.DziTileSource.prototype=new Seadragon.TileSource;Seadragon.DziTileSource.prototype.constructor=Seadragon.DziTileSource;Seadragon.DziTileSource.prototype.initialize=function(){if(!this.displayRects){return}for(var a=this.displayRects.length-1;a>=0;a--){var b=this.displayRects[a];for(var c=b.minLevel;c<=b.maxLevel;c++){if(!this._levelRects[c]){this._levelRects[c]=[]}this._levelRects[c].push(b)}}};Seadragon.DziTileSource.prototype.getTileUrl=function(a,b,c){return[this.tilesUrl,a,"/",b,"_",c,".",this.fileFormat].join("")};Seadragon.DziTileSource.prototype.tileExists=function(a,b,c){var d=this._levelRects[a];if(!d||!d.length){return true}for(var e=d.length-1;e>=0;e--){var f=d[e];if(a<f.minLevel||a>f.maxLevel){continue}var g=this.getLevelScale(a);var h=f.x*g;var i=f.y*g;var j=h+f.width*g;var k=i+f.height*g;h=Math.floor(h/this.tileSize);i=Math.floor(i/this.tileSize);j=Math.ceil(j/this.tileSize);k=Math.ceil(k/this.tileSize);if(h<=b&&b<j&&i<=c&&c<k){return true}}return false};Seadragon._DziTileSourceHelper=function(){};Seadragon._DziTileSourceHelper.prototype={createFromXml:function(a,b,c){function j(a,b){try{return a(b,i)}catch(c){if(d){e=this.getError(c).message;return null}else{throw this.getError(c)}}}var d=typeof c=="function";var e=null;if(!a){this.error=Seadragon.Strings.getString("Errors.Empty");if(d){window.setTimeout(function(){c(null,e)},1);return null}throw new Seadragon.DziError(e)}var f=a.split("/");var g=f[f.length-1];var h=g.lastIndexOf(".");if(h>-1){f[f.length-1]=g.slice(0,h)}var i=f.join("/")+"_files/";if(d){if(b){var k=Function.createDelegate(this,this.processXml);window.setTimeout(function(){var a=j(k,Seadragon.Utils.parseXml(b));c(a,e)},1)}else{var k=Function.createDelegate(this,this.processResponse);Seadragon.Utils.makeAjaxRequest(a,function(a){var b=j(k,a);c(b,e)})}return null}if(b){return j(Function.createDelegate(this,this.processXml),Seadragon.Utils.parseXml(b))}else{return j(Function.createDelegate(this,this.processResponse),Seadragon.Utils.makeAjaxRequest(a))}},processResponse:function(a,b){if(!a){throw new Seadragon.DziError(Seadragon.Strings.getString("Errors.Security"))}else if(a.status!==200&&a.status!==0){var c=a.status;var d=c==404?"Not Found":a.statusText;throw new Seadragon.DziError(Seadragon.Strings.getString("Errors.Status",c,d))}var e=null;if(a.responseXML&&a.responseXML.documentElement){e=a.responseXML}else if(a.responseText){e=Seadragon.Utils.parseXml(a.responseText)}return this.processXml(e,b)},processXml:function(a,b){if(!a||!a.documentElement){throw new Seadragon.DziError(Seadragon.Strings.getString("Errors.Xml"))}var c=a.documentElement;var d=c.tagName;if(d=="Image"){try{return this.processDzi(c,b)}catch(e){var f=Seadragon.Strings.getString("Errors.Dzi");throw e instanceof Seadragon.DziError?e:new Seadragon.DziError(f)}}else if(d=="Collection"){throw new Seadragon.DziError(Seadragon.Strings.getString("Errors.Dzc"))}else if(d=="Error"){return this.processError(c)}throw new Seadragon.DziError(Seadragon.Strings.getString("Errors.Dzi"))},processDzi:function(a,b){var c=a.getAttribute("Format");if(!Seadragon.Utils.imageFormatSupported(c)){throw new Seadragon.DziError(Seadragon.Strings.getString("Errors.ImageFormat",c.toUpperCase()))}var d=a.getElementsByTagName("Size")[0];var e=a.getElementsByTagName("DisplayRect");var f=parseInt(d.getAttribute("Width"),10);var g=parseInt(d.getAttribute("Height"),10);var h=parseInt(a.getAttribute("TileSize"));var i=parseInt(a.getAttribute("Overlap"));var j=[];for(var k=0;k<e.length;k++){var l=e[k];var m=l.getElementsByTagName("Rect")[0];j.push(new Seadragon.DisplayRect(parseInt(m.getAttribute("X"),10),parseInt(m.getAttribute("Y"),10),parseInt(m.getAttribute("Width"),10),parseInt(m.getAttribute("Height"),10),0,parseInt(l.getAttribute("MaxLevel"),10)))}return new Seadragon.DziTileSource(f,g,h,i,b,c,j)},processError:function(a){var b=a.getElementsByTagName("Message")[0];var c=b.firstChild.nodeValue;throw new Seadragon.DziError(c)},getError:function(a){if(!(a instanceof DziError)){Seadragon.Debug.error(a.name+" while creating DZI from XML: "+a.message);a=new Seadragon.DziError(Seadragon.Strings.getString("Errors.Unknown"))}}};Seadragon.DziTileSourceHelper=new Seadragon._DziTileSourceHelper;Seadragon.ButtonState=function(){throw Error.invalidOperation()};Seadragon.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3};Seadragon.Button=function(a,b){this._tooltip=a.tooltip;this._srcRest=a.srcRest;this._srcGroup=a.srcGroup;this._srcHover=a.srcHover;this._srcDown=a.srcDown;this._button=a.button;this.config=a.config;this.initialize(b)};Seadragon.Button.prototype={initialize:function(a){this._observer=new Observer;if(a.onPress!=undefined)this.add_onPress(a.onPress);if(a.onRelease!=undefined)this.add_onRelease(a.onRelease);if(a.onClick!=undefined)this.add_onClick(a.onClick);if(a.onEnter!=undefined)this.add_onEnter(a.onEnter);if(a.onExit!=undefined)this.add_onExit(a.onExit);this._button=Seadragon.Utils.makeNeutralElement("span");this._currentState=Seadragon.ButtonState.GROUP;this._tracker=new Seadragon.MouseTracker(this._button,this.config.clickTimeThreshold,this.config.clickDistThreshold);this._imgRest=Seadragon.Utils.makeTransparentImage(this._srcRest);this._imgGroup=Seadragon.Utils.makeTransparentImage(this._srcGroup);this._imgHover=Seadragon.Utils.makeTransparentImage(this._srcHover);this._imgDown=Seadragon.Utils.makeTransparentImage(this._srcDown);this._fadeDelay=0;this._fadeLength=2e3;this._fadeBeginTime=null;this._shouldFade=false;this._button.style.display="inline-block";this._button.style.position="relative";this._button.title=this._tooltip;this._button.appendChild(this._imgRest);this._button.appendChild(this._imgGroup);this._button.appendChild(this._imgHover);this._button.appendChild(this._imgDown);var b=this._imgRest.style;var c=this._imgGroup.style;var d=this._imgHover.style;var e=this._imgDown.style;c.position=d.position=e.position="absolute";c.top=d.top=e.top="0px";c.left=d.left=e.left="0px";d.visibility=e.visibility="hidden";if(Seadragon.Utils.getBrowser()==Seadragon.Browser.FIREFOX&&Seadragon.Utils.getBrowserVersion()<3){c.top=d.top=e.top=""}this._tracker.enterHandler=Function.createDelegate(this,this._enterHandler);this._tracker.exitHandler=Function.createDelegate(this,this._exitHandler);this._tracker.pressHandler=Function.createDelegate(this,this._pressHandler);this._tracker.releaseHandler=Function.createDelegate(this,this._releaseHandler);this._tracker.clickHandler=Function.createDelegate(this,this._clickHandler);this._tracker.setTracking(true);this._outTo(Seadragon.ButtonState.REST)},dispose:function(){},_scheduleFade:function(){window.setTimeout(Function.createDelegate(this,this._updateFade),20)},_updateFade:function(){if(this._shouldFade){var a=(new Date).getTime();var b=a-this._fadeBeginTime;var c=1-b/this._fadeLength;c=Math.min(1,c);c=Math.max(0,c);Seadragon.Utils.setElementOpacity(this._imgGroup,c,true);if(c>0){this._scheduleFade()}}},_beginFading:function(){this._shouldFade=true;this._fadeBeginTime=(new Date).getTime()+this._fadeDelay;window.setTimeout(Function.createDelegate(this,this._scheduleFade),this._fadeDelay)},_stopFading:function(){this._shouldFade=false;Seadragon.Utils.setElementOpacity(this._imgGroup,1,true)},_inTo:function(a){if(a>=Seadragon.ButtonState.GROUP&&this._currentState==Seadragon.ButtonState.REST){this._stopFading();this._currentState=Seadragon.ButtonState.GROUP}if(a>=Seadragon.ButtonState.HOVER&&this._currentState==Seadragon.ButtonState.GROUP){this._imgHover.style.visibility="";this._currentState=Seadragon.ButtonState.HOVER}if(a>=Seadragon.ButtonState.DOWN&&this._currentState==Seadragon.ButtonState.HOVER){this._imgDown.style.visibility="";this._currentState=Seadragon.ButtonState.DOWN}},_outTo:function(a){if(a<=Seadragon.ButtonState.HOVER&&this._currentState==Seadragon.ButtonState.DOWN){this._imgDown.style.visibility="hidden";this._currentState=Seadragon.ButtonState.HOVER}if(a<=Seadragon.ButtonState.GROUP&&this._currentState==Seadragon.ButtonState.HOVER){this._imgHover.style.visibility="hidden";this._currentState=Seadragon.ButtonState.GROUP}if(this._newState<=Seadragon.ButtonState.REST&&this._currentState==Seadragon.ButtonState.GROUP){this._beginFading();this._currentState=Seadragon.ButtonState.REST}},_enterHandler:function(a,b,c,d){if(c){this._inTo(Seadragon.ButtonState.DOWN);this._raiseEvent("onEnter",this)}else if(!d){this._inTo(Seadragon.ButtonState.HOVER)}},_exitHandler:function(a,b,c,d){this._outTo(Seadragon.ButtonState.GROUP);if(c){this._raiseEvent("onExit",this)}},_pressHandler:function(a,b){this._inTo(Seadragon.ButtonState.DOWN);this._raiseEvent("onPress",this)},_releaseHandler:function(a,b,c,d){if(c&&d){this._outTo(Seadragon.ButtonState.HOVER);this._raiseEvent("onRelease",this)}else if(c){this._outTo(Seadragon.ButtonState.GROUP)}else{this._inTo(Seadragon.ButtonState.HOVER)}},_clickHandler:function(a,b,c,d){if(c){this._raiseEvent("onClick",this)}},get_events:function c(){return this._observer._getContext(this,true).events},_raiseEvent:function(a,b){var c=this.get_events().getHandler(a);if(c){if(!b){b=new Object}c(this,b)}},get_element:function(){return this._button},get_tooltip:function(){return this._tooltip},set_tooltip:function(a){this._tooltip=a},get_config:function(){return this.config},set_config:function(a){this.config=a},get_srcRest:function(){return this._srcRest},set_srcRest:function(a){this._srcRest=a},get_srcGroup:function(){return this._srcGroup},set_srcGroup:function(a){this._srcGroup=a},get_srcHover:function(){return this._srcHover},set_srcHover:function(a){this._srcHover=a},get_srcDown:function(){return this._srcDown},set_srcDown:function(a){this._srcDown=a},add_onPress:function(a){this.get_events().addHandler("onPress",a)},remove_onPress:function(a){this.get_events().removeHandler("onPress",a)},add_onClick:function(a){this.get_events().addHandler("onClick",a)},remove_onClick:function(a){this.get_events().removeHandler("onClick",a)},add_onEnter:function(a){this.get_events().addHandler("onEnter",a)},remove_onEnter:function(a){this.get_events().removeHandler("onEnter",a)},add_onRelease:function(a){this.get_events().addHandler("onRelease",a)},remove_onRelease:function(a){this.get_events().removeHandler("onRelease",a)},add_onExit:function(a){this.get_events().addHandler("onExit",a)},remove_onExit:function(a){this.get_events().removeHandler("onExit",a)},notifyGroupEnter:function(){this._inTo(Seadragon.ButtonState.GROUP)},notifyGroupExit:function(){this._outTo(Seadragon.ButtonState.REST)}};Seadragon.ButtonGroup=function(a){this._buttons=a.buttons;this._group=a.group;this.config=a.config;this.initialize()};Seadragon.ButtonGroup.prototype={initialize:function(){this._group=Seadragon.Utils.makeNeutralElement("span");var a=this._buttons.concat([]);var b=new Seadragon.MouseTracker(this._group,this.config.clickTimeThreshold,this.config.clickDistThreshold);this._group.style.display="inline-block";for(var c=0;c<a.length;c++){this._group.appendChild(a[c].get_element())}b.enterHandler=Function.createDelegate(this,this._enterHandler);b.exitHandler=Function.createDelegate(this,this._exitHandler);b.releaseHandler=Function.createDelegate(this,this._releaseHandler);b.setTracking(true)},dispose:function(){},get_buttons:function(){return this._buttons},set_buttons:function(a){this._buttons=a},get_element:function(){return this._group},get_config:function(){return this.config},set_config:function(a){this.config=a},_enterHandler:function(a,b,c,d){for(var e=0;e<this._buttons.length;e++){this._buttons[e].notifyGroupEnter()}},_exitHandler:function(a,b,c,d){if(!c){for(var e=0;e<this._buttons.length;e++){this._buttons[e].notifyGroupExit()}}},_releaseHandler:function(a,b,c,d){if(!d){for(var e=0;e<this._buttons.length;e++){this._buttons[e].notifyGroupExit()}}},emulateEnter:function(){this._enterHandler()},emulateExit:function(){this._exitHandler()}};Seadragon.Config=function(){this.debugMode=false;this.animationTime=1.5;this.blendTime=.5;this.alwaysBlend=false;this.autoHideControls=true;this.immediateRender=true;this.wrapHorizontal=false;this.wrapVertical=false;this.minZoomImageRatio=.8;this.maxZoomPixelRatio=2;this.visibilityRatio=.5;this.springStiffness=5;this.imageLoaderLimit=2;this.clickTimeThreshold=200;this.clickDistThreshold=5;this.zoomPerClick=2;this.zoomPerScroll=1.2;this.zoomPerSecond=2;this.showNavigationControl=true;this.maxImageCacheCount=100;this.minPixelRatio=.5;this.mouseNavEnabled=true;this.navImages={zoomIn:{REST:SeadragonConfig.imgPath+"OpenSeadragon/images/zoomin_rest.png",GROUP:SeadragonConfig.imgPath+"OpenSeadragon/images/zoomin_grouphover.png",HOVER:SeadragonConfig.imgPath+"OpenSeadragon/images/zoomin_hover.png",DOWN:SeadragonConfig.imgPath+"OpenSeadragon/images/zoomin_pressed.png"},zoomOut:{REST:SeadragonConfig.imgPath+"OpenSeadragon/images/zoomout_rest.png",GROUP:SeadragonConfig.imgPath+"OpenSeadragon/images/zoomout_grouphover.png",HOVER:SeadragonConfig.imgPath+"OpenSeadragon/images/zoomout_hover.png",DOWN:SeadragonConfig.imgPath+"OpenSeadragon/images/zoomout_pressed.png"},home:{REST:SeadragonConfig.imgPath+"OpenSeadragon/images/home_rest.png",GROUP:SeadragonConfig.imgPath+"OpenSeadragon/images/home_grouphover.png",HOVER:SeadragonConfig.imgPath+"OpenSeadragon/images/home_hover.png",DOWN:SeadragonConfig.imgPath+"OpenSeadragon/images/home_pressed.png"},fullpage:{REST:SeadragonConfig.imgPath+"OpenSeadragon/images/fullpage_rest.png",GROUP:SeadragonConfig.imgPath+"OpenSeadragon/images/fullpage_grouphover.png",HOVER:SeadragonConfig.imgPath+"OpenSeadragon/images/fullpage_hover.png",DOWN:SeadragonConfig.imgPath+"OpenSeadragon/images/fullpage_pressed.png"}}};Seadragon.Rect=function(a,b,c,d){this.x=typeof a=="number"?a:0;this.y=typeof b=="number"?b:0;this.width=typeof c=="number"?c:0;this.height=typeof d=="number"?d:0};Seadragon.Rect.prototype={getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new Seadragon.Point(this.x,this.y)},getBottomRight:function(){return new Seadragon.Point(this.x+this.width,this.y+this.height)},getCenter:function(){return new Seadragon.Point(this.x+this.width/2,this.y+this.height/2)},getSize:function(){return new Seadragon.Point(this.width,this.height)},equals:function(a){return a instanceof Seadragon.Rect&&this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height},toString:function(){return"["+this.x+","+this.y+","+this.width+"x"+this.height+"]"}};Seadragon.DisplayRect=function(a,b,c,d,e,f){Seadragon.Rect.apply(this,[a,b,c,d]);this.minLevel=e;this.maxLevel=f};Seadragon.DisplayRect.prototype=new Seadragon.Rect;Seadragon.DisplayRect.prototype.constructor=Seadragon.DisplayRect;Seadragon.Spring=Seadragon.Spring=function(a,b){this._currentValue=typeof a=="number"?a:0;this._startValue=this._currentValue;this._targetValue=this._currentValue;this.config=b;this._currentTime=(new Date).getTime();this._startTime=this._currentTime;this._targetTime=this._currentTime};Seadragon.Spring.prototype={_transform:function(a){var b=this.config.springStiffness;return(1-Math.exp(-a*b))/(1-Math.exp(-b))},getCurrent:function(){return this._currentValue},getTarget:function(){return this._targetValue},resetTo:function(a){this._targetValue=a;this._targetTime=this._currentTime;this._startValue=this._targetValue;this._startTime=this._targetTime},springTo:function(a){this._startValue=this._currentValue;this._startTime=this._currentTime;this._targetValue=a;this._targetTime=this._startTime+1e3*this.config.animationTime},shiftBy:function(a){this._startValue+=a;this._targetValue+=a},update:function(){this._currentTime=(new Date).getTime();this._currentValue=this._currentTime>=this._targetTime?this._targetValue:this._startValue+(this._targetValue-this._startValue)*this._transform((this._currentTime-this._startTime)/(this._targetTime-this._startTime))}};var QUOTA=100;var MIN_PIXEL_RATIO=.5;var browser=Seadragon.Utils.getBrowser();var browserVer=Seadragon.Utils.getBrowserVersion();var subpixelRenders=browser==Seadragon.Browser.FIREFOX||browser==Seadragon.Browser.OPERA||browser==Seadragon.Browser.SAFARI&&browserVer>=4||browser==Seadragon.Browser.CHROME&&browserVer>=2;var useCanvas=typeof document.createElement("canvas").getContext=="function"&&subpixelRenders;Seadragon.Tile=function(a,b,c,d,e,f){this.level=a;this.x=b;this.y=c;this.bounds=d;this.exists=e;this.loaded=false;this.loading=false;this.elmt=null;this.image=null;this.url=f;this.style=null;this.position=null;this.size=null;this.blendStart=null;this.opacity=null;this.distance=null;this.visibility=null;this.beingDrawn=false;this.lastTouchTime=0};Seadragon.Tile.prototype={dispose:function(){},toString:function(){return this.level+"/"+this.x+"_"+this.y},drawHTML:function(a){if(!this.loaded){Seadragon.Debug.error("Attempting to draw tile "+this.toString()+" when it's not yet loaded.");return}if(!this.elmt){this.elmt=Seadragon.Utils.makeNeutralElement("img");this.elmt.src=this.url;this.style=this.elmt.style;this.style.position="absolute";this.style.msInterpolationMode="nearest-neighbor"}var b=this.elmt;var c=this.style;var d=this.position.apply(Math.floor);var e=this.size.apply(Math.ceil);if(b.parentNode!=a){a.appendChild(b)}c.left=d.x+"px";c.top=d.y+"px";c.width=e.x+"px";c.height=e.y+"px";Seadragon.Utils.setElementOpacity(b,this.opacity)},drawCanvas:function(a){if(!this.loaded){Seadragon.Debug.error("Attempting to draw tile "+this.toString()+" when it's not yet loaded.");return}var b=this.position;var c=this.size;a.globalAlpha=this.opacity;a.drawImage(this.image,b.x,b.y,c.x,c.y)},unload:function(){if(this.elmt&&this.elmt.parentNode){this.elmt.parentNode.removeChild(this.elmt)}this.elmt=null;this.image=null;this.loaded=false;this.loading=false}};Seadragon.Overlay=function(a,b,c){this.elmt=a;this.scales=b instanceof Seadragon.Rect;this.bounds=new Seadragon.Rect(b.x,b.y,b.width,b.height);this.placement=b instanceof Seadragon.Point?c:Seadragon.OverlayPlacement.TOP_LEFT;this.position=new Seadragon.Point(b.x,b.y);this.size=new Seadragon.Point(b.width,b.height);this.style=a.style};Seadragon.Overlay.prototype={adjust:function(a,b){switch(this.placement){case Seadragon.OverlayPlacement.TOP_LEFT:break;case Seadragon.OverlayPlacement.TOP:a.x-=b.x/2;break;case Seadragon.OverlayPlacement.TOP_RIGHT:a.x-=b.x;break;case Seadragon.OverlayPlacement.RIGHT:a.x-=b.x;a.y-=b.y/2;break;case Seadragon.OverlayPlacement.BOTTOM_RIGHT:a.x-=b.x;a.y-=b.y;break;case Seadragon.OverlayPlacement.BOTTOM:a.x-=b.x/2;a.y-=b.y;break;case Seadragon.OverlayPlacement.BOTTOM_LEFT:a.y-=b.y;break;case Seadragon.OverlayPlacement.LEFT:a.y-=b.y/2;break;case Seadragon.OverlayPlacement.CENTER:default:a.x-=b.x/2;a.y-=b.y/2;break}},destroy:function(){var a=this.elmt;var b=this.style;if(a.parentNode){a.parentNode.removeChild(a)}b.top="";b.left="";b.position="";if(this.scales){b.width="";b.height=""}},drawHTML:function(a){var b=this.elmt;var c=this.style;var d=this.scales;if(b.parentNode!=a){a.appendChild(b)}if(!d){this.size=Seadragon.Utils.getElementSize(b)}var e=this.position;var f=this.size;this.adjust(e,f);e=e.apply(Math.floor);f=f.apply(Math.ceil);c.left=e.x+"px";c.top=e.y+"px";c.position="absolute";if(d){c.width=f.x+"px";c.height=f.y+"px"}},update:function(a,b){this.scales=a instanceof Seadragon.Rect;this.bounds=new Seadragon.Rect(a.x,a.y,a.width,a.height);this.placement=a instanceof Seadragon.Point?b:Seadragon.OverlayPlacement.TOP_LEFT}};Seadragon.Drawer=function(a,b,c){this._container=Seadragon.Utils.getElement(c);this._canvas=Seadragon.Utils.makeNeutralElement(useCanvas?"canvas":"div");this._context=useCanvas?this._canvas.getContext("2d"):null;this._viewport=b;this._source=a;this.config=this._viewport.config;this._imageLoader=new Seadragon.ImageLoader(this.config.imageLoaderLimit);this._profiler=new Seadragon.Profiler;this._minLevel=a.minLevel;this._maxLevel=a.maxLevel;this._tileSize=a.tileSize;this._tileOverlap=a.tileOverlap;this._normHeight=a.dimensions.y/a.dimensions.x;this._cacheNumTiles={};this._cachePixelRatios={};this._tilesMatrix={};this._tilesLoaded=[];this._coverage={};this._overlays=[];this._lastDrawn=[];this._lastResetTime=0;this._midUpdate=false;this._updateAgain=true;this.elmt=this._container;this._init()};Seadragon.Drawer.prototype={dispose:function(){},_init:function(){this._canvas.style.width="100%";this._canvas.style.height="100%";this._canvas.style.position="absolute";this._container.style.textAlign="left";this._container.appendChild(this._canvas)},_compareTiles:function(a,b){if(!a){return b}if(b.visibility>a.visibility){return b}else if(b.visibility==a.visibility){if(b.distance<a.distance){return b}}return a},_getNumTiles:function(a){if(!this._cacheNumTiles[a]){this._cacheNumTiles[a]=this._source.getNumTiles(a)}return this._cacheNumTiles[a]},_getPixelRatio:function(a){if(!this._cachePixelRatios[a]){this._cachePixelRatios[a]=this._source.getPixelRatio(a)}return this._cachePixelRatios[a]},_getTile:function(a,b,c,d,e,f){if(!this._tilesMatrix[a]){this._tilesMatrix[a]={}}if(!this._tilesMatrix[a][b]){this._tilesMatrix[a][b]={}}if(!this._tilesMatrix[a][b][c]){var g=(e+b%e)%e;var h=(f+c%f)%f;var i=this._source.getTileBounds(a,g,h);var j=this._source.tileExists(a,g,h);var k=this._source.getTileUrl(a,g,h);i.x+=1*(b-g)/e;i.y+=this._normHeight*(c-h)/f;this._tilesMatrix[a][b][c]=new Seadragon.Tile(a,b,c,i,j,k)}var l=this._tilesMatrix[a][b][c];l.lastTouchTime=d;return l},_loadTile:function(a,b){a.loading=this._imageLoader.loadImage(a.url,Seadragon.Utils.createCallback(null,Function.createDelegate(this,this._onTileLoad),a,b))},_onTileLoad:function(a,b,c){a.loading=false;if(this._midUpdate){Seadragon.Debug.error("Tile load callback in middle of drawing routine.");return}else if(!c){Seadragon.Debug.log("Tile "+a+" failed to load: "+a.url);a.exists=false;return}else if(b<this._lastResetTime){Seadragon.Debug.log("Ignoring tile "+a+" loaded before reset: "+a.url);return}a.loaded=true;a.image=c;var d=this._tilesLoaded.length;if(this._tilesLoaded.length>=QUOTA){var e=Math.ceil(Math.log(this._tileSize)/Math.log(2));var f=null;var g=-1;for(var h=this._tilesLoaded.length-1;h>=0;h--){var i=this._tilesLoaded[h];if(i.level<=this._cutoff||i.beingDrawn){continue}else if(!f){f=i;g=h;continue}var j=i.lastTouchTime;var k=f.lastTouchTime;var l=i.level;var m=f.level;if(j<k||j==k&&l>m){f=i;g=h}}if(f&&g>=0){f.unload();d=g}}this._tilesLoaded[d]=a;this._updateAgain=true},_clearTiles:function(){this._tilesMatrix={};this._tilesLoaded=[]},_providesCoverage:function(a,b,c){if(!this._coverage[a]){return false}if(b===undefined||c===undefined){var d=this._coverage[a];for(var e in d){if(d.hasOwnProperty(e)){var f=d[e];for(var g in f){if(f.hasOwnProperty(g)&&!f[g]){return false}}}}return true}return this._coverage[a][b]===undefined||this._coverage[a][b][c]===undefined||this._coverage[a][b][c]===true},_isCovered:function(a,b,c){if(b===undefined||c===undefined){return this._providesCoverage(a+1)}else{return this._providesCoverage(a+1,2*b,2*c)&&this._providesCoverage(a+1,2*b,2*c+1)&&this._providesCoverage(a+1,2*b+1,2*c)&&this._providesCoverage(a+1,2*b+1,2*c+1)}},_setCoverage:function(a,b,c,d){if(!this._coverage[a]){Seadragon.Debug.error("Setting coverage for a tile before its "+"level's coverage has been reset: "+a);return}if(!this._coverage[a][b]){this._coverage[a][b]={}}this._coverage[a][b][c]=d},_resetCoverage:function(a){this._coverage[a]={}},_compareTiles:function(a,b){if(!a){return b}if(b.visibility>a.visibility){return b}else if(b.visibility==a.visibility){if(b.distance<a.distance){return b}}return a},_getOverlayIndex:function(a){for(var b=this._overlays.length-1;b>=0;b--){if(this._overlays[b].elmt==a){return b}}return-1},_updateActual:function(){this._updateAgain=false;var a=this._canvas;var b=this._context;var c=this._container;var d=useCanvas;var e=this._lastDrawn;while(e.length>0){var f=e.pop();f.beingDrawn=false}var g=this._viewport.getContainerSize();var h=g.x;var i=g.y;a.innerHTML="";if(d){a.width=h;a.height=i;b.clearRect(0,0,h,i)}var j=this._viewport.getBounds(true);var k=j.getTopLeft();var l=j.getBottomRight();if(!this.config.wrapHorizontal&&(l.x<0||k.x>1)){return}else if(!this.config.wrapVertical&&(l.y<0||k.y>this._normHeight)){return}var m=Math.abs;var n=Math.ceil;var o=Math.floor;var p=Math.log;var q=Math.max;var r=Math.min;var s=this.config.alwaysBlend;var t=1e3*this.config.blendTime;var u=this.config.immediateRender;var v=this.config.wrapHorizontal;var w=this.config.wrapVertical;if(!v){k.x=q(k.x,0);l.x=r(l.x,1)}if(!w){k.y=q(k.y,0);l.y=r(l.y,this._normHeight)}var x=null;var y=false;var z=(new Date).getTime();var A=this._viewport.pixelFromPoint(this._viewport.getCenter());var B=this._viewport.deltaPixelsFromPoints(this._source.getPixelRatio(0),false).x;var C=u?1:B;var D=q(this._minLevel,o(p(this.config.minZoomImageRatio)/p(2)));var E=this._viewport.deltaPixelsFromPoints(this._source.getPixelRatio(0),true).x;var F=r(this._maxLevel,o(p(E/MIN_PIXEL_RATIO)/p(2)));D=r(D,F);for(var G=F;G>=D;G--){var H=false;var I=this._viewport.deltaPixelsFromPoints(this._source.getPixelRatio(G),true).x;if(!y&&I>=MIN_PIXEL_RATIO||G==D){H=true;y=true}else if(!y){continue}this._resetCoverage(G);var J=r(1,(I-.5)/.5);var K=this._viewport.deltaPixelsFromPoints(this._source.getPixelRatio(G),false).x;var L=C/m(C-K);var M=this._source.getTileAtPoint(G,k);var N=this._source.getTileAtPoint(G,l);var O=this._getNumTiles(G);var P=O.x;var Q=O.y;if(!v){N.x=r(N.x,P-1)}if(!w){N.y=r(N.y,Q-1)}for(var R=M.x;R<=N.x;R++){for(var S=M.y;S<=N.y;S++){var f=this._getTile(G,R,S,z,P,Q);var T=H;this._setCoverage(G,R,S,false);if(!f.exists){continue}if(y&&!T){if(this._isCovered(G,R,S)){this._setCoverage(G,R,S,true)}else{T=true}}if(!T){continue}var U=f.bounds.getTopLeft();var V=f.bounds.getSize();var W=this._viewport.pixelFromPoint(U,true);var X=this._viewport.deltaPixelsFromPoints(V,true);if(!this._tileOverlap){X=X.plus(new Seadragon.Point(1,1))}var Y=this._viewport.pixelFromPoint(U,false);var Z=this._viewport.deltaPixelsFromPoints(V,false);var $=Y.plus(Z.divide(2));var _=A.distanceTo($);f.position=W;f.size=X;f.distance=_;f.visibility=L;if(f.loaded){if(!f.blendStart){f.blendStart=z}var ba=z-f.blendStart;var bb=r(1,ba/t);if(s){bb*=J}f.opacity=bb;e.push(f);if(bb==1){this._setCoverage(G,R,S,true)}else if(ba<t){updateAgain=true}}else if(f.Loading){}else{x=this._compareTiles(x,f)}}}if(this._providesCoverage(G)){break}}for(var bc=e.length-1;bc>=0;bc--){var f=e[bc];if(d){f.drawCanvas(b)}else{f.drawHTML(a)}f.beingDrawn=true}var bd=this._overlays.length;for(var bc=0;bc<bd;bc++){var be=this._overlays[bc];var bf=be.bounds;be.position=this._viewport.pixelFromPoint(bf.getTopLeft(),true);be.size=this._viewport.deltaPixelsFromPoints(bf.getSize(),true);be.drawHTML(c)}if(x){this._loadTile(x,z);this._updateAgain=true}},addOverlay:function(a,b,c){var a=Seadragon.Utils.getElement(a);if(this._getOverlayIndex(a)>=0){return}this._overlays.push(new Seadragon.Overlay(a,b,c));this._updateAgain=true},updateOverlay:function(a,b,c){var a=Seadragon.Utils.getElement(a);var d=this._getOverlayIndex(a);if(d>=0){this._overlays[d].update(b,c);this._updateAgain=true}},removeOverlay:function(a){var a=Seadragon.Utils.getElement(a);var b=this._getOverlayIndex(a);if(b>=0){this._overlays[b].destroy();this._overlays.splice(b,1);this._updateAgain=true}},clearOverlays:function(){while(this._overlays.length>0){this._overlays.pop().destroy();this._updateAgain=true}},needsUpdate:function(){return this._updateAgain},numTilesLoaded:function(){return this._tilesLoaded.length},reset:function(){this._clearTiles();this._lastResetTime=(new Date).getTime();this._updateAgain=true},update:function(){this._profiler.beginUpdate();this._midUpdate=true;this._updateActual();this._midUpdate=false;this._profiler.endUpdate()},idle:function(){}};Seadragon.Viewport=function(a,b,c){this.zoomPoint=null;this.config=c;this._containerSize=a;this._contentSize=b;this._contentAspect=b.x/b.y;this._contentHeight=b.y/b.x;this._centerSpringX=new Seadragon.Spring(0,this.config);this._centerSpringY=new Seadragon.Spring(0,this.config);this._zoomSpring=new Seadragon.Spring(1,this.config);this._homeBounds=new Seadragon.Rect(0,0,1,this._contentHeight);this.goHome(true);this.update()};Seadragon.Viewport.prototype={_getHomeZoom:function(){var a=this._contentAspect/this.getAspectRatio();return a>=1?1:a},_getMinZoom:function(){var a=this._getHomeZoom();var b=this.config.minZoomImageRatio*a;return Math.min(b,a)},_getMaxZoom:function(){var a=this._contentSize.x*this.config.maxZoomPixelRatio/this._containerSize.x;return Math.max(a,this._getHomeZoom())},getAspectRatio:function(){return this._containerSize.x/this._containerSize.y},getContainerSize:function(){return new Seadragon.Point(this._containerSize.x,this._containerSize.y)},getBounds:function(a){var b=this.getCenter(a);var c=1/this.getZoom(a);var d=c/this.getAspectRatio();return new Seadragon.Rect(b.x-c/2,b.y-d/2,c,d)},getCenter:function(a){var b=new Seadragon.Point(this._centerSpringX.getCurrent(),this._centerSpringY.getCurrent());var c=new Seadragon.Point(this._centerSpringX.getTarget(),this._centerSpringY.getTarget());if(a){return b}else if(!this.zoomPoint){return c}var d=this.pixelFromPoint(this.zoomPoint,true);var e=this.getZoom();var f=1/e;var g=f/this.getAspectRatio();var h=new Seadragon.Rect(b.x-f/2,b.y-g/2,f,g);var i=this.zoomPoint.minus(h.getTopLeft()).times(this._containerSize.x/h.width);var j=i.minus(d);var k=j.divide(this._containerSize.x*e);return c.plus(k)},getZoom:function(a){if(a){return this._zoomSpring.getCurrent()}else{return this._zoomSpring.getTarget()}},applyConstraints:function(a){var b=this.getZoom();var c=Math.max(Math.min(b,this._getMaxZoom()),this._getMinZoom());if(b!=c){this.zoomTo(c,this.zoomPoint,a)}var d=this.getBounds();var e=this.config.visibilityRatio;var f=e*d.width;var g=e*d.height;var h=d.x+d.width;var i=1-d.x;var j=d.y+d.height;var k=this._contentHeight-d.y;var l=0;if(this.config.wrapHorizontal){}else if(h<f){l=f-h}else if(i<f){l=i-f}var m=0;if(this.config.wrapVertical){}else if(j<g){m=g-j}else if(k<g){m=k-g}if(l||m){d.x+=l;d.y+=m;this.fitBounds(d,a)}},ensureVisible:function(a){this.applyConstraints(a)},fitBounds:function(a,b){var c=this.getAspectRatio();var d=a.getCenter();var e=new Seadragon.Rect(a.x,a.y,a.width,a.height);if(e.getAspectRatio()>=c){e.height=a.width/c;e.y=d.y-e.height/2}else{e.width=a.height*c;e.x=d.x-e.width/2}this.panTo(this.getCenter(true),true);this.zoomTo(this.getZoom(true),null,true);var f=this.getBounds();var g=this.getZoom();var h=1/e.width;if(h==g||e.width==f.width){this.panTo(d,b);return}var i=f.getTopLeft().times(this._containerSize.x/f.width).minus(e.getTopLeft().times(this._containerSize.x/e.width)).divide(this._containerSize.x/f.width-this._containerSize.x/e.width);this.zoomTo(h,i,b)},goHome:function(a){var b=this.getCenter();if(this.config.wrapHorizontal){b.x=(1+b.x%1)%1;this._centerSpringX.resetTo(b.x);this._centerSpringX.update()}if(this.config.wrapVertical){b.y=(this._contentHeight+b.y%this._contentHeight)%this._contentHeight;this._centerSpringY.resetTo(b.y);this._centerSpringY.update()}this.fitBounds(this._homeBounds,a)},panBy:function(a,b){var c=new Seadragon.Point(this._centerSpringX.getTarget(),this._centerSpringY.getTarget());this.panTo(c.plus(a),b)},panTo:function(a,b){if(b){this._centerSpringX.resetTo(a.x);this._centerSpringY.resetTo(a.y)}else{this._centerSpringX.springTo(a.x);this._centerSpringY.springTo(a.y)}},zoomBy:function(a,b,c){this.zoomTo(this._zoomSpring.getTarget()*a,b,c)},zoomTo:function(a,b,c){if(c){this._zoomSpring.resetTo(a)}else{this._zoomSpring.springTo(a)}this.zoomPoint=b instanceof Seadragon.Point?b:null},resize:function(a,b){var c=this.getBounds();var d=c;var e=a.x/this._containerSize.x;this._containerSize=new Seadragon.Point(a.x,a.y);if(b){d.width=c.width*e;d.height=d.width/this.getAspectRatio()}this.fitBounds(d,true)},update:function(){var a=this._centerSpringX.getCurrent();var b=this._centerSpringY.getCurrent();var c=this._zoomSpring.getCurrent();if(this.zoomPoint){var d=this.pixelFromPoint(this.zoomPoint,true)}this._zoomSpring.update();if(this.zoomPoint&&this._zoomSpring.getCurrent()!=c){var e=this.pixelFromPoint(this.zoomPoint,true);var f=e.minus(d);var g=this.deltaPointsFromPixels(f,true);this._centerSpringX.shiftBy(g.x);this._centerSpringY.shiftBy(g.y)}else{this.zoomPoint=null}this._centerSpringX.update();this._centerSpringY.update();return this._centerSpringX.getCurrent()!=a||this._centerSpringY.getCurrent()!=b||this._zoomSpring.getCurrent()!=c},deltaPixelsFromPoints:function(a,b){return a.times(this._containerSize.x*this.getZoom(b))},deltaPointsFromPixels:function(a,b){return a.divide(this._containerSize.x*this.getZoom(b))},pixelFromPoint:function(a,b){var c=this.getBounds(b);return a.minus(c.getTopLeft()).times(this._containerSize.x/c.width)},pointFromPixel:function(a,b){var c=this.getBounds(b);return a.divide(this._containerSize.x/c.width).plus(c.getTopLeft())}};Seadragon.Debug={};Seadragon.Debug.fail=function(){};Seadragon.Debug.log=function(){};Seadragon.Debug.error=function(){}